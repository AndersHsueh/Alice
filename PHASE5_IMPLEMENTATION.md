# Phase 5: UI é›†æˆå®Œæˆ

## ğŸ“‹ å®ç°æ¦‚è§ˆ

å·²æˆåŠŸå®Œæˆ Phase 5 çš„ UI é›†æˆï¼Œå°†å·¥å…·ç³»ç»Ÿå®Œæ•´é›†æˆåˆ°ä¸»åº”ç”¨ä¸­ã€‚

## âœ… å®ŒæˆåŠŸèƒ½

### 1. ä¸»åº”ç”¨æ”¹é€  (`src/cli/app.tsx`)

#### æ–°å¢å¯¼å…¥
```typescript
import { ToolCallStatus } from './components/ToolCallStatus.js';
import { DangerousCommandConfirm } from './components/DangerousCommandConfirm.js';
import { toolRegistry, builtinTools } from '../tools/index.js';
import type { ToolCallRecord } from '../types/tool.js';
```

#### æ–°å¢çŠ¶æ€ç®¡ç†
```typescript
const [toolRecords, setToolRecords] = useState<ToolCallRecord[]>([]);
const [confirmDialog, setConfirmDialog] = useState<{
  message: string;
  command: string;
  onConfirm: (confirmed: boolean) => void;
} | null>(null);
const [streamingContent, setStreamingContent] = useState('');
```

#### å·¥å…·ç³»ç»Ÿåˆå§‹åŒ–
- **æ³¨å†Œå·¥å…·**: `toolRegistry.registerAll(builtinTools)`
- **å¯ç”¨å·¥å…·æ”¯æŒ**: `client.enableTools(config)`
- **è®¾ç½®ç¡®è®¤å¤„ç†å™¨**: 
  ```typescript
  client.setConfirmHandler(async (message, command) => {
    return new Promise((resolve) => {
      setConfirmDialog({ message, command, onConfirm: resolve });
    });
  });
  ```

#### å¯¹è¯æµç¨‹å‡çº§
**ä¹‹å‰**:
```typescript
const response = await llmClient.chat([...messages, userMsg]);
```

**ç°åœ¨**:
```typescript
for await (const chunk of llmClient.chatStreamWithTools(
  [...messages, userMsg],
  (record) => {
    // å®æ—¶æ›´æ–°å·¥å…·è°ƒç”¨çŠ¶æ€
    setToolRecords(prev => { /* ... */ });
  }
)) {
  setStreamingContent(prev => prev + chunk);
}
```

### 2. ChatArea ç»„ä»¶å‡çº§ (`src/cli/components/ChatArea.tsx`)

#### æ–°å¢ Props
```typescript
interface ChatAreaProps {
  messages: Message[];
  isProcessing: boolean;
  streamingContent?: string;  // æ–°å¢
}
```

#### æµå¼å†…å®¹å±•ç¤º
```typescript
{streamingContent && (
  <Box flexDirection="column" marginBottom={1}>
    <Box>
      <Text bold color="green">Alice: </Text>
    </Box>
    <Box marginLeft={2} flexDirection="column">
      <Text wrap="wrap">{streamingContent}</Text>
    </Box>
  </Box>
)}
```

### 3. UI å¸ƒå±€æ•´åˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header (å·¥ä½œåŒº + æ¨¡å‹)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚ ChatArea                            â”‚
â”‚  - å†å²æ¶ˆæ¯                         â”‚
â”‚  - æµå¼å†…å®¹ï¼ˆå®æ—¶æ˜¾ç¤ºï¼‰             â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ToolCallStatus (å·¥å…·æ‰§è¡ŒçŠ¶æ€)      â”‚
â”‚  ğŸ”§ [è¯»å–æ–‡ä»¶] æ­£åœ¨è¯»å–...          â”‚
â”‚  âœ… [æœç´¢æ–‡ä»¶] æ‰¾åˆ° 23 ä¸ªæ–‡ä»¶       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DangerousCommandConfirm (ç¡®è®¤æ¡†)   â”‚
â”‚  âš ï¸  å±é™©å‘½ä»¤è­¦å‘Š                   â”‚
â”‚  ç¡®è®¤æ‰§è¡Œ? (y/N):                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ InputBox (è¾“å…¥æ¡†)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### æ­£å¸¸å¯¹è¯æµç¨‹
```
1. ç”¨æˆ·è¾“å…¥ "ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ"
   â†“
2. LLM åˆ†æå¹¶å†³å®šè°ƒç”¨ getCurrentDateTime å·¥å…·
   â†“
3. UI æ˜¾ç¤ºå·¥å…·çŠ¶æ€ï¼š
   [ğŸ”§ è·å–å½“å‰æ—¶é—´] æ­£åœ¨æ‰§è¡Œ...
   â†“
4. å·¥å…·æ‰§è¡Œå®Œæˆï¼š
   [âœ… è·å–å½“å‰æ—¶é—´] æ‰§è¡ŒæˆåŠŸ
   â†“
5. LLM æ ¹æ®å·¥å…·ç»“æœç”Ÿæˆå›å¤ï¼ˆæµå¼è¾“å‡ºï¼‰ï¼š
   "ç°åœ¨æ˜¯ 2026 å¹´ 2 æœˆ 10 æ—¥ 21:40..."
   â†“
6. ä¿å­˜åˆ°æ¶ˆæ¯å†å²
```

### å±é™©å‘½ä»¤æµç¨‹
```
1. ç”¨æˆ·è¾“å…¥ "åˆ é™¤ node_modules"
   â†“
2. LLM å†³å®šè°ƒç”¨ executeCommand å·¥å…·
   â†“
3. å·¥å…·æ£€æµ‹åˆ°å±é™©å‘½ä»¤
   â†“
4. æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†ï¼š
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ âš ï¸  å±é™©å‘½ä»¤è­¦å‘Š          â”‚
   â”‚ å‘½ä»¤: rm -rf node_modules â”‚
   â”‚ ç¡®è®¤æ‰§è¡Œ? (y/N):         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
5a. ç”¨æˆ·æŒ‰ 'y' â†’ æ‰§è¡Œå‘½ä»¤ â†’ LLM ç”Ÿæˆç»“æœ
5b. ç”¨æˆ·æŒ‰ 'n' â†’ å–æ¶ˆæ‰§è¡Œ â†’ è¿”å›é”™è¯¯
```

## ğŸ“¦ ä¿®æ”¹æ–‡ä»¶

```
src/cli/
â”œâ”€â”€ app.tsx                    [ä¿®æ”¹] é›†æˆå·¥å…·ç³»ç»Ÿ
â””â”€â”€ components/
    â””â”€â”€ ChatArea.tsx          [ä¿®æ”¹] æ”¯æŒæµå¼å†…å®¹
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### âœ… å·²å®ç°
1. **å·¥å…·è‡ªåŠ¨åˆå§‹åŒ–** - å¯åŠ¨æ—¶æ³¨å†Œæ‰€æœ‰å†…ç½®å·¥å…·
2. **æµå¼å¯¹è¯ + å·¥å…·è°ƒç”¨** - æ— ç¼é›†æˆ
3. **å®æ—¶çŠ¶æ€å±•ç¤º** - å·¥å…·æ‰§è¡Œè¿›åº¦å®æ—¶æ›´æ–°
4. **å±é™©å‘½ä»¤ç¡®è®¤** - äº¤äº’å¼ç¡®è®¤å¯¹è¯æ¡†
5. **çŠ¶æ€éš”ç¦»** - å·¥å…·çŠ¶æ€ä¸æ±¡æŸ“æ¶ˆæ¯å†å²
6. **è¾“å…¥ç¦ç”¨** - å·¥å…·æ‰§è¡Œ/ç¡®è®¤æ—¶ç¦æ­¢è¾“å…¥

### ğŸ”‘ å…³é”®å®ç°

#### 1. å·¥å…·çŠ¶æ€æ›´æ–°
```typescript
setToolRecords(prev => {
  const index = prev.findIndex(r => r.id === record.id);
  if (index >= 0) {
    // æ›´æ–°ç°æœ‰è®°å½•
    const updated = [...prev];
    updated[index] = record;
    return updated;
  }
  // æ·»åŠ æ–°è®°å½•
  return [...prev, record];
});
```

#### 2. ç¡®è®¤å¯¹è¯æ¡† Promise å°è£…
```typescript
client.setConfirmHandler(async (message, command) => {
  return new Promise((resolve) => {
    setConfirmDialog({
      message,
      command,
      onConfirm: (confirmed) => {
        setConfirmDialog(null);  // å…³é—­å¯¹è¯æ¡†
        resolve(confirmed);       // è¿”å›ç”¨æˆ·é€‰æ‹©
      }
    });
  });
});
```

#### 3. æµå¼å†…å®¹ç´¯ç§¯
```typescript
for await (const chunk of llmClient.chatStreamWithTools(...)) {
  setStreamingContent(prev => prev + chunk);
}

// æµç»“æŸåä¿å­˜å®Œæ•´æ¶ˆæ¯
const assistantMsg: Message = {
  role: 'assistant',
  content: streamingContent,  // ç´¯ç§¯çš„å®Œæ•´å†…å®¹
  timestamp: new Date(),
};
```

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: ç®€å•å·¥å…·è°ƒç”¨
```bash
npm run dev

> You: ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ

[ğŸ”§ è·å–å½“å‰æ—¶é—´] æ­£åœ¨æ‰§è¡Œ...
[âœ… è·å–å½“å‰æ—¶é—´] æ‰§è¡ŒæˆåŠŸ

Alice: ç°åœ¨æ˜¯ 2026 å¹´ 2 æœˆ 10 æ—¥ 21:40ï¼Œæ˜ŸæœŸäºŒã€‚
```

### åœºæ™¯ 2: æ–‡ä»¶æœç´¢
```bash
> You: è¿™ä¸ªé¡¹ç›®æœ‰å¤šå°‘ä¸ª TypeScript æ–‡ä»¶ï¼Ÿ

[ğŸ” æœç´¢æ–‡ä»¶] æ­£åœ¨æœç´¢ **/*.ts...
[ğŸ” æœç´¢æ–‡ä»¶] æ‰¾åˆ° 25 ä¸ªæ–‡ä»¶

Alice: é¡¹ç›®ä¸­å…±æœ‰ 25 ä¸ª TypeScript æ–‡ä»¶ï¼Œä¸»è¦åˆ†å¸ƒåœ¨...
```

### åœºæ™¯ 3: å±é™©å‘½ä»¤ç¡®è®¤
```bash
> You: åˆ é™¤ node_modules

[ğŸ”§ æ‰§è¡Œå‘½ä»¤] å‡†å¤‡æ‰§è¡Œ...

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸  å±é™©å‘½ä»¤è­¦å‘Š                  â”‚
â”‚ å‘½ä»¤: rm -rf node_modules        â”‚
â”‚ ç¡®è®¤æ‰§è¡Œ? (y/N): _              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

(ç”¨æˆ·æŒ‰ y)

[ğŸ”§ æ‰§è¡Œå‘½ä»¤] æ‰§è¡Œä¸­...
[âœ… æ‰§è¡Œå‘½ä»¤] å‘½ä»¤æ‰§è¡Œå®Œæˆ

Alice: node_modules å·²åˆ é™¤ï¼Œä½ å¯ä»¥è¿è¡Œ npm install é‡æ–°å®‰è£…ä¾èµ–ã€‚
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### LM Studio å…¼å®¹æ€§
å½“å‰å®ç°ä½¿ç”¨ OpenAI Function Calling æ ¼å¼ã€‚éœ€è¦ï¼š

1. **LM Studio ç‰ˆæœ¬**
   - éœ€è¦æ”¯æŒ Function Calling çš„ç‰ˆæœ¬
   - æŸäº›æ—§ç‰ˆæœ¬å¯èƒ½è¿”å› 400 é”™è¯¯

2. **æ¨¡å‹è¦æ±‚**
   - ä½¿ç”¨æ”¯æŒ Function Calling çš„æ¨¡å‹
   - æ¨èï¼šGPT-3.5-turbo, GPT-4, æˆ–å…¼å®¹æ¨¡å‹

3. **é™çº§ç­–ç•¥**
   - å¦‚æœé‡åˆ° `tools` å‚æ•°ä¸æ”¯æŒé”™è¯¯
   - å¯å›é€€åˆ°æ™®é€š `chat()` æ–¹æ³•
   - æˆ–æç¤ºç”¨æˆ·æ›´æ–° LM Studio/æ¨¡å‹

### çŠ¶æ€ç®¡ç†æ³¨æ„
- `streamingContent` éœ€è¦åœ¨æµç»“æŸåæ¸…ç©º
- `toolRecords` éœ€è¦åœ¨æ–°å¯¹è¯å¼€å§‹æ—¶æ¸…ç©º
- `confirmDialog` ç¡®è®¤åå¿…é¡»å…³é—­

## ğŸš€ ä¸‹ä¸€æ­¥

### ç«‹å³å¯åš
1. **è¿è¡Œæµ‹è¯•**: `npm run dev`
2. **éªŒè¯å·¥å…·è°ƒç”¨**: è¯¢é—®æ—¶é—´ã€æœç´¢æ–‡ä»¶ç­‰
3. **æµ‹è¯•å±é™©å‘½ä»¤**: å°è¯•åˆ é™¤æ“ä½œ

### åç»­æ”¹è¿›
1. **ç³»ç»Ÿæç¤ºè¯ä¼˜åŒ–** - å‘ŠçŸ¥ AI å¦‚ä½•ä½¿ç”¨å·¥å…·
2. **å·¥å…·è°ƒç”¨æ—¥å¿—** - è®°å½•æ‰€æœ‰å·¥å…·è°ƒç”¨å†å²
3. **æ€§èƒ½ä¼˜åŒ–** - ç¼“å­˜å·¥å…·ç»“æœ
4. **æ›´å¤šå·¥å…·** - æ·»åŠ æ›´å¤šå®ç”¨å·¥å…·
5. **è·¨å¹³å°æµ‹è¯•** - macOS å’Œ Linux éªŒè¯

## ğŸ“Š ç»Ÿè®¡

- **ä»£ç å˜æ›´**: ~100 è¡Œ
- **ä¿®æ”¹æ–‡ä»¶**: 2 ä¸ª
- **æ–°å¢ä¾èµ–**: 0 ä¸ª
- **ç¼–è¯‘çŠ¶æ€**: âœ… é€šè¿‡
- **åŠŸèƒ½å®Œæ•´æ€§**: âœ… å®Œæ•´é›†æˆ

## ğŸ‰ æ€»ç»“

Phase 5 å®Œæˆï¼ALICE ç°åœ¨æ˜¯ä¸€ä¸ªå®Œæ•´çš„ **AI + Tools** ç³»ç»Ÿï¼š

âœ… **Phase 1**: å·¥å…·ç³»ç»ŸåŸºç¡€æ¶æ„  
âœ… **Phase 2**: LLM Function Calling é›†æˆ  
âœ… **Phase 3**: 7 ä¸ªå†…ç½®å·¥å…·  
âœ… **Phase 4**: UI ç»„ä»¶  
âœ… **Phase 5**: ä¸»åº”ç”¨é›†æˆ  

ç”¨æˆ·ç°åœ¨å¯ä»¥ï¼š
- ğŸ“ è®© AI è¯»å–æ–‡ä»¶
- ğŸ” è®© AI æœç´¢æ–‡ä»¶
- â° è¯¢é—®æ—¶é—´å’Œæ—¥æœŸ
- ğŸ“‚ æŸ¥çœ‹ç›®å½•å†…å®¹
- ğŸ”§ æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼ˆå¸¦ç¡®è®¤ï¼‰
- ğŸŒ¿ æŸ¥çœ‹ Git ä¿¡æ¯

**å®Œæ•´çš„å·¥å…·é©±åŠ¨ AI åŠ©æ‰‹å·²ç»å°±ç»ªï¼**
