---
title: å·¥å…·ç³»ç»Ÿ
aliases: [Function Calling, å·¥å…·è°ƒç”¨]
tags: [æŠ€æœ¯æ–‡æ¡£, å·¥å…·ç³»ç»Ÿ, AIèƒ½åŠ›]
date: 2026-02-11
version: 0.2.0
status: å·²å®ç°
---

# å·¥å…·ç³»ç»Ÿ (Function Calling) ğŸ› ï¸

> **è®¾è®¡ç†å¿µ**: èµ‹äºˆ AI è‡ªä¸»æ“ä½œèƒ½åŠ›ï¼Œä»å¯¹è¯åŠ©æ‰‹è¿›åŒ–ä¸ºè¡ŒåŠ¨åŠ©æ‰‹

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

### ä»€ä¹ˆæ˜¯ Function Calling?

Function Calling (å‡½æ•°è°ƒç”¨) æ˜¯ AI å¤§è¯­è¨€æ¨¡å‹çš„ä¸€é¡¹é«˜çº§èƒ½åŠ›ï¼Œå…è®¸æ¨¡å‹ï¼š

1. **ç†è§£ç”¨æˆ·æ„å›¾** - è¯†åˆ«ä½•æ—¶éœ€è¦å¤–éƒ¨å·¥å…·
2. **é€‰æ‹©åˆé€‚å·¥å…·** - ä»å·¥å…·åº“ä¸­é€‰æ‹©æœ€åŒ¹é…çš„å·¥å…·
3. **ç”Ÿæˆè°ƒç”¨å‚æ•°** - è‡ªåŠ¨æå–å’Œæ ¼å¼åŒ–å‚æ•°
4. **å¤„ç†è¿”å›ç»“æœ** - æ•´åˆå·¥å…·è¾“å‡ºåˆ°å¯¹è¯ä¸­

### æ ¸å¿ƒä»·å€¼

| ä»·å€¼ç‚¹ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| ğŸ¯ **è‡ªä¸»æ€§** | AI è‡ªå·±å†³å®šä½•æ—¶ä½¿ç”¨å·¥å…· | ç”¨æˆ·é—®"å‡ ç‚¹äº†"ï¼ŒAI è‡ªåŠ¨è°ƒç”¨ `getCurrentDateTime` |
| ğŸ”§ **èƒ½åŠ›æ‰©å±•** | çªç ´çº¯æ–‡æœ¬é™åˆ¶ | è¯»æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ã€æŸ¥è¯¢æ•°æ®åº“ |
| ğŸš€ **æ•ˆç‡æå‡** | ä¸€æ¬¡å¯¹è¯å®Œæˆå¤šæ­¥æ“ä½œ | "åˆ†æè¿™ä¸ªæ–‡ä»¶å¹¶ç”ŸæˆæŠ¥å‘Š" |
| ğŸ›¡ï¸ **å¯æ§æ€§** | å·¥å…·æ‰§è¡Œå¯è§ã€å¯å®¡è®¡ | æ˜¾ç¤ºå·¥å…·è°ƒç”¨çŠ¶æ€å’Œç»“æœ |

## ğŸ¨ æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LLM (å¤§è¯­è¨€æ¨¡å‹)                 â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ç†è§£ç”¨æˆ·æ„å›¾                        â”‚   â”‚
â”‚  â”‚  â†“                                   â”‚   â”‚
â”‚  â”‚  é€‰æ‹©å·¥å…·: readFile                  â”‚   â”‚
â”‚  â”‚  â†“                                   â”‚   â”‚
â”‚  â”‚  ç”Ÿæˆå‚æ•°: { filePath: "pkg.json" } â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ tool_calls
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ToolExecutor (å·¥å…·æ‰§è¡Œå™¨)        â”‚
â”‚                                             â”‚
â”‚  1. æ¥æ”¶ tool_calls                         â”‚
â”‚  2. æŸ¥æ‰¾å·¥å…·å¤„ç†å™¨                          â”‚
â”‚  3. éªŒè¯å‚æ•°                                â”‚
â”‚  4. å®‰å…¨æ£€æŸ¥ (å±é™©å‘½ä»¤?)                    â”‚
â”‚  5. æ‰§è¡Œå·¥å…·                                â”‚
â”‚  6. æ”¶é›†ç»“æœ                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ ToolResult[]
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Tool Registry (å·¥å…·æ³¨å†Œè¡¨)        â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚readFile  â”‚  â”‚listFiles â”‚  â”‚searchFilesâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚getCurDir â”‚  â”‚getGitInfoâ”‚  â”‚getDateTimeâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚  â”‚execCmd   â”‚  ...æ›´å¤šå·¥å…·                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

#### 1. ToolDefinition (å·¥å…·å®šä¹‰)

```typescript
interface ToolDefinition {
  type: 'function';
  function: FunctionSchema;
}

interface FunctionSchema {
  name: string;                    // å·¥å…·åç§°
  description: string;             // åŠŸèƒ½æè¿° (ä¾› LLM ç†è§£)
  parameters: JSONSchema;          // å‚æ•° Schema
}

// ç¤ºä¾‹
const readFileTool: ToolDefinition = {
  type: 'function',
  function: {
    name: 'readFile',
    description: 'è¯»å–æ–‡ä»¶å†…å®¹ã€‚æ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„ã€‚',
    parameters: {
      type: 'object',
      properties: {
        filePath: {
          type: 'string',
          description: 'è¦è¯»å–çš„æ–‡ä»¶è·¯å¾„'
        }
      },
      required: ['filePath']
    }
  }
};
```

#### 2. ToolHandler (å·¥å…·å¤„ç†å™¨)

```typescript
type ToolHandler<T = any, R = any> = (params: T) => Promise<R>;

// ç¤ºä¾‹
const readFileHandler: ToolHandler = async (params: { filePath: string }) => {
  const { filePath } = params;
  
  // å®‰å…¨æ£€æŸ¥
  if (!isPathSafe(filePath)) {
    throw new Error('è·¯å¾„ä¸å®‰å…¨');
  }
  
  // æ‰§è¡Œ
  const content = await fs.readFile(filePath, 'utf-8');
  
  // è¿”å›
  return {
    filePath,
    content,
    size: content.length,
    encoding: 'utf-8'
  };
};
```

#### 3. ToolExecutor (å·¥å…·æ‰§è¡Œå™¨)

```typescript
export class ToolExecutor {
  private registry: Map<string, ToolHandler> = new Map();
  private schemas: Map<string, FunctionSchema> = new Map();
  
  // æ³¨å†Œå·¥å…·
  register(schema: FunctionSchema, handler: ToolHandler) {
    this.schemas.set(schema.name, schema);
    this.registry.set(schema.name, handler);
  }
  
  // æ‰§è¡Œå·¥å…·
  async execute(toolCall: ToolCall): Promise<ToolResult> {
    const { function: func } = toolCall;
    
    // 1. æŸ¥æ‰¾å¤„ç†å™¨
    const handler = this.registry.get(func.name);
    if (!handler) {
      return {
        success: false,
        error: `å·¥å…· ${func.name} æœªæ³¨å†Œ`
      };
    }
    
    try {
      // 2. è§£æå‚æ•°
      const params = JSON.parse(func.arguments);
      
      // 3. å‚æ•°éªŒè¯
      this.validateParams(func.name, params);
      
      // 4. å®‰å…¨æ£€æŸ¥
      if (func.name === 'executeCommand') {
        const confirmed = await this.confirmDangerous(params.command);
        if (!confirmed) {
          return {
            success: false,
            error: 'ç”¨æˆ·å–æ¶ˆæ‰§è¡Œ'
          };
        }
      }
      
      // 5. æ‰§è¡Œ
      const result = await handler(params);
      
      // 6. è¿”å›
      return {
        success: true,
        data: result
      };
    } catch (error) {
      return {
        success: false,
        error: error.message
      };
    }
  }
  
  // è·å–æ‰€æœ‰å·¥å…·å®šä¹‰ (ä¾› LLM ä½¿ç”¨)
  getToolDefinitions(): ToolDefinition[] {
    return Array.from(this.schemas.values()).map(schema => ({
      type: 'function',
      function: schema
    }));
  }
}
```

## ğŸ”§ å†…ç½®å·¥å…·æ¸…å•

### 1. readFile - è¯»å–æ–‡ä»¶

**åŠŸèƒ½**: è¯»å–æ–‡ä»¶å†…å®¹

**å‚æ•°**:
```typescript
{
  filePath: string  // æ–‡ä»¶è·¯å¾„ (ç›¸å¯¹æˆ–ç»å¯¹)
}
```

**è¿”å›**:
```typescript
{
  filePath: string,
  content: string,
  size: number,       // å­—èŠ‚æ•°
  encoding: string    // ç¼–ç 
}
```

**ç¤ºä¾‹**:
```
ç”¨æˆ·: "è¯»å– package.json çš„å†…å®¹"
å·¥å…·è°ƒç”¨: readFile({ filePath: "package.json" })
è¿”å›: { content: "{\n  \"name\": \"alice-cli\"...", size: 1024 }
AI å›å¤: "ä½ çš„é¡¹ç›®åç§°æ˜¯ alice-cliï¼Œç‰ˆæœ¬ 0.2.0..."
```

### 2. listFiles - åˆ—å‡ºç›®å½•æ–‡ä»¶

**åŠŸèƒ½**: åˆ—å‡ºæŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•

**å‚æ•°**:
```typescript
{
  directoryPath: string,  // ç›®å½•è·¯å¾„
  recursive?: boolean     // æ˜¯å¦é€’å½’ (é»˜è®¤ false)
}
```

**è¿”å›**:
```typescript
{
  path: string,
  files: string[],       // æ–‡ä»¶åˆ—è¡¨
  directories: string[], // ç›®å½•åˆ—è¡¨
  total: number
}
```

**ç¤ºä¾‹**:
```
ç”¨æˆ·: "src ç›®å½•ä¸‹æœ‰å“ªäº›æ–‡ä»¶?"
å·¥å…·è°ƒç”¨: listFiles({ directoryPath: "src" })
è¿”å›: { files: ["index.tsx", "app.tsx"], directories: ["cli", "core"] }
AI å›å¤: "src ç›®å½•åŒ…å« 2 ä¸ªæ–‡ä»¶å’Œ 2 ä¸ªå­ç›®å½•..."
```

### 3. searchFiles - æœç´¢æ–‡ä»¶

**åŠŸèƒ½**: ä½¿ç”¨ glob æ¨¡å¼æœç´¢æ–‡ä»¶

**å‚æ•°**:
```typescript
{
  pattern: string,       // glob æ¨¡å¼
  baseDir?: string      // åŸºç¡€ç›®å½• (é»˜è®¤å½“å‰ç›®å½•)
}
```

**è¿”å›**:
```typescript
{
  pattern: string,
  matches: string[],    // åŒ¹é…çš„æ–‡ä»¶
  count: number
}
```

**ç¤ºä¾‹**:
```
ç”¨æˆ·: "æ‰¾å‡ºæ‰€æœ‰ TypeScript æ–‡ä»¶"
å·¥å…·è°ƒç”¨: searchFiles({ pattern: "**/*.ts" })
è¿”å›: { matches: ["src/index.ts", "src/app.ts"...], count: 25 }
AI å›å¤: "æ‰¾åˆ° 25 ä¸ª TypeScript æ–‡ä»¶ï¼Œä¸»è¦åˆ†å¸ƒåœ¨..."
```

### 4. getCurrentDirectory - è·å–å½“å‰ç›®å½•

**åŠŸèƒ½**: è·å–å½“å‰å·¥ä½œç›®å½•

**å‚æ•°**: æ— 

**è¿”å›**:
```typescript
{
  path: string,          // å½“å‰ç›®å½•è·¯å¾„
  basename: string       // ç›®å½•å
}
```

**ç¤ºä¾‹**:
```
ç”¨æˆ·: "å½“å‰åœ¨å“ªä¸ªç›®å½•?"
å·¥å…·è°ƒç”¨: getCurrentDirectory()
è¿”å›: { path: "/home/user/alice-cli", basename: "alice-cli" }
AI å›å¤: "ä½ å½“å‰åœ¨ alice-cli ç›®å½•"
```

### 5. getGitInfo - è·å– Git ä¿¡æ¯

**åŠŸèƒ½**: æŸ¥çœ‹å½“å‰ Git ä»“åº“ä¿¡æ¯

**å‚æ•°**: æ— 

**è¿”å›**:
```typescript
{
  isRepo: boolean,       // æ˜¯å¦æ˜¯ Git ä»“åº“
  branch: string,        // å½“å‰åˆ†æ”¯
  commit: string,        // æœ€æ–°æäº¤ SHA
  remote: string,        // è¿œç¨‹ä»“åº“ URL
  status: {
    modified: string[],  // ä¿®æ”¹çš„æ–‡ä»¶
    added: string[],     // æ–°å¢çš„æ–‡ä»¶
    deleted: string[]    // åˆ é™¤çš„æ–‡ä»¶
  }
}
```

**ç¤ºä¾‹**:
```
ç”¨æˆ·: "æŸ¥çœ‹ Git çŠ¶æ€"
å·¥å…·è°ƒç”¨: getGitInfo()
è¿”å›: { branch: "main", modified: ["src/app.tsx"], ... }
AI å›å¤: "å½“å‰åˆ†æ”¯ mainï¼Œæœ‰ 1 ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹..."
```

### 6. getCurrentDateTime - è·å–å½“å‰æ—¶é—´

**åŠŸèƒ½**: è·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´

**å‚æ•°**: æ— 

**è¿”å›**:
```typescript
{
  datetime: string,      // ISO 8601 æ ¼å¼
  timestamp: number,     // Unix æ—¶é—´æˆ³
  timezone: string,      // æ—¶åŒº
  formatted: {
    date: string,        // "2026-02-11"
    time: string,        // "14:30:00"
    full: string         // "2026-02-11 14:30:00"
  }
}
```

**ç¤ºä¾‹**:
```
ç”¨æˆ·: "ç°åœ¨å‡ ç‚¹äº†?"
å·¥å…·è°ƒç”¨: getCurrentDateTime()
è¿”å›: { formatted: { full: "2026-02-11 14:30:00" } }
AI å›å¤: "ç°åœ¨æ˜¯ 2026 å¹´ 2 æœˆ 11 æ—¥ 14:30"
```

### 7. executeCommand - æ‰§è¡Œç³»ç»Ÿå‘½ä»¤

**åŠŸèƒ½**: æ‰§è¡Œ Shell å‘½ä»¤ (éœ€ç”¨æˆ·ç¡®è®¤)

**å‚æ•°**:
```typescript
{
  command: string,       // è¦æ‰§è¡Œçš„å‘½ä»¤
  cwd?: string          // å·¥ä½œç›®å½• (å¯é€‰)
}
```

**è¿”å›**:
```typescript
{
  command: string,
  stdout: string,        // æ ‡å‡†è¾“å‡º
  stderr: string,        // æ ‡å‡†é”™è¯¯
  exitCode: number,      // é€€å‡ºç 
  success: boolean
}
```

**ç¤ºä¾‹**:
```
ç”¨æˆ·: "è¿è¡Œæµ‹è¯•"
å·¥å…·è°ƒç”¨: executeCommand({ command: "npm test" })

[âš ï¸ å±é™©å‘½ä»¤ç¡®è®¤]
å‘½ä»¤: npm test
ç¡®è®¤æ‰§è¡Œ? (y/N): y

è¿”å›: { stdout: "All tests passed", exitCode: 0 }
AI å›å¤: "æµ‹è¯•å…¨éƒ¨é€šè¿‡!"
```

## ğŸ”„ å·¥ä½œæµç¨‹

### å®Œæ•´è°ƒç”¨æµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant LLM as LLM
    participant TE as ToolExecutor
    participant TH as ToolHandler
    
    U->>LLM: "è¯»å– package.json"
    
    Note over LLM: 1. ç†è§£æ„å›¾<br/>éœ€è¦è¯»å–æ–‡ä»¶
    
    LLM->>LLM: ç”Ÿæˆ tool_calls
    
    Note over LLM: tool_call: {<br/>  name: "readFile",<br/>  arguments: '{"filePath":"package.json"}'<br/>}
    
    LLM->>TE: execute(tool_call)
    
    TE->>TE: 1. æŸ¥æ‰¾å¤„ç†å™¨
    TE->>TE: 2. è§£æå‚æ•°
    TE->>TE: 3. éªŒè¯å‚æ•°
    TE->>TE: 4. å®‰å…¨æ£€æŸ¥
    
    TE->>TH: handler({ filePath: "package.json" })
    
    TH->>TH: fs.readFile(...)
    
    TH-->>TE: { content: "...", size: 1024 }
    
    TE-->>LLM: ToolResult
    
    LLM->>LLM: è¿½åŠ  tool result åˆ°æ¶ˆæ¯
    
    LLM->>LLM: ç”Ÿæˆæœ€ç»ˆå›å¤
    
    LLM-->>U: "ä½ çš„é¡¹ç›®åç§°æ˜¯ alice-cli..."
```

### å¤šå·¥å…·è°ƒç”¨æµç¨‹

```
ç”¨æˆ·: "åˆ†æè¿™ä¸ªé¡¹ç›®çš„ç»“æ„"

LLM åˆ†æ:
1. éœ€è¦è·å–å½“å‰ç›®å½•
2. éœ€è¦åˆ—å‡ºæ–‡ä»¶
3. éœ€è¦è¯»å– package.json

ç”Ÿæˆ 3 ä¸ª tool_calls:
- getCurrentDirectory()
- listFiles({ directoryPath: "." })
- readFile({ filePath: "package.json" })

é¡ºåºæ‰§è¡Œ:
[å·¥å…· 1] getCurrentDirectory â†’ { path: "/home/user/alice" }
[å·¥å…· 2] listFiles â†’ { files: [...], directories: [...] }
[å·¥å…· 3] readFile â†’ { content: "..." }

LLM ç»¼åˆç»“æœ:
"è¿™æ˜¯ä¸€ä¸ª Node.js é¡¹ç›®ï¼Œä¸»è¦ä½¿ç”¨ TypeScript..."
```

## ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶

### 1. å±é™©å‘½ä»¤æ£€æµ‹

```typescript
const DANGEROUS_PATTERNS = [
  /rm\s+-rf/,              // å¼ºåˆ¶åˆ é™¤
  /sudo/,                  // ææƒ
  /chmod\s+777/,           // æƒé™ä¿®æ”¹
  />.*\/dev\/sd[a-z]/,     // ç£ç›˜æ“ä½œ
  /mkfs/,                  // æ ¼å¼åŒ–
  /dd\s+if=/,              // ç£ç›˜å†™å…¥
  /shutdown/,              // å…³æœº
  /reboot/,                // é‡å¯
  /:\(\)\{.*\}/,           // Fork ç‚¸å¼¹
];

function isDangerousCommand(cmd: string): boolean {
  return DANGEROUS_PATTERNS.some(pattern => pattern.test(cmd));
}
```

### 2. ç”¨æˆ·ç¡®è®¤æµç¨‹

```typescript
async function confirmDangerousCommand(command: string): Promise<boolean> {
  if (!config.dangerous_cmd) {
    return true;  // é…ç½®ç¦ç”¨ç¡®è®¤ï¼Œç›´æ¥æ‰§è¡Œ
  }
  
  if (!isDangerousCommand(command)) {
    return true;  // éå±é™©å‘½ä»¤ï¼Œç›´æ¥æ‰§è¡Œ
  }
  
  // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
  return await showConfirmDialog({
    title: 'âš ï¸ å±é™©å‘½ä»¤è­¦å‘Š',
    message: `å‘½ä»¤: ${command}\nç¡®è®¤æ‰§è¡Œ?`,
    defaultValue: false
  });
}
```

### 3. è·¯å¾„å®‰å…¨

```typescript
function isPathSafe(filePath: string): boolean {
  const resolved = path.resolve(filePath);
  const workspace = path.resolve(config.workspace);
  
  // æ£€æŸ¥æ˜¯å¦åœ¨å·¥ä½œåŒºå†…
  if (!resolved.startsWith(workspace)) {
    throw new Error('ä¸å…è®¸è®¿é—®å·¥ä½œåŒºå¤–çš„æ–‡ä»¶');
  }
  
  // æ£€æŸ¥æ˜¯å¦æ˜¯ç¬¦å·é“¾æ¥
  const stats = fs.lstatSync(resolved);
  if (stats.isSymbolicLink()) {
    throw new Error('ä¸å…è®¸è®¿é—®ç¬¦å·é“¾æ¥');
  }
  
  return true;
}
```

### 4. å‚æ•°éªŒè¯

```typescript
class ToolExecutor {
  private validateParams(toolName: string, params: any) {
    const schema = this.schemas.get(toolName);
    if (!schema) return;
    
    // ä½¿ç”¨ ajv éªŒè¯ JSON Schema
    const validate = ajv.compile(schema.parameters);
    const valid = validate(params);
    
    if (!valid) {
      throw new Error(`å‚æ•°éªŒè¯å¤±è´¥: ${ajv.errorsText(validate.errors)}`);
    }
  }
}
```

## ğŸ“Š çŠ¶æ€å±•ç¤º

### UI çŠ¶æ€ç»„ä»¶

```typescript
// ToolCallStatus.tsx
export const ToolCallStatus: React.FC<{ toolCall: ToolCall }> = ({ toolCall }) => {
  const [status, setStatus] = useState<'pending' | 'success' | 'error'>('pending');
  
  const icon = {
    pending: 'â³',
    success: 'âœ…',
    error: 'âŒ'
  }[status];
  
  const color = {
    pending: 'yellow',
    success: 'green',
    error: 'red'
  }[status];
  
  return (
    <Box>
      <Text color={color}>
        {icon} [{toolCall.function.name}] {getStatusText(status, toolCall)}
      </Text>
    </Box>
  );
};
```

### çŠ¶æ€æ–‡æ¡ˆ

| å·¥å…· | Pending | Success | Error |
|------|---------|---------|-------|
| readFile | æ­£åœ¨è¯»å–... | æ–‡ä»¶è¯»å–æˆåŠŸ | è¯»å–å¤±è´¥ |
| listFiles | æ­£åœ¨æ‰«æ... | æ‰¾åˆ° N ä¸ªæ–‡ä»¶ | æ‰«æå¤±è´¥ |
| searchFiles | æ­£åœ¨æœç´¢... | æ‰¾åˆ° N ä¸ªåŒ¹é… | æœç´¢å¤±è´¥ |
| executeCommand | æ­£åœ¨æ‰§è¡Œ... | æ‰§è¡Œå®Œæˆ | æ‰§è¡Œå¤±è´¥ |

## ğŸ”Œ æ‰©å±•å·¥å…·

### æ·»åŠ è‡ªå®šä¹‰å·¥å…·

```typescript
// 1. å®šä¹‰ Schema
const customToolSchema: FunctionSchema = {
  name: 'myCustomTool',
  description: 'æˆ‘çš„è‡ªå®šä¹‰å·¥å…·',
  parameters: {
    type: 'object',
    properties: {
      param1: { type: 'string', description: 'å‚æ•°1' }
    },
    required: ['param1']
  }
};

// 2. å®ç° Handler
const customToolHandler: ToolHandler = async (params: { param1: string }) => {
  // å®ç°é€»è¾‘
  return { result: 'success' };
};

// 3. æ³¨å†Œå·¥å…·
toolExecutor.register(customToolSchema, customToolHandler);
```

### å·¥å…·æ’ä»¶ç³»ç»Ÿ (è§„åˆ’)

```typescript
// æ’ä»¶æ¥å£
interface ToolPlugin {
  name: string;
  version: string;
  tools: Array<{
    schema: FunctionSchema;
    handler: ToolHandler;
  }>;
  
  initialize?(): Promise<void>;
  cleanup?(): Promise<void>;
}

// æ’ä»¶ç®¡ç†å™¨
class ToolPluginManager {
  async loadPlugin(pluginPath: string) {
    const plugin = await import(pluginPath);
    
    // æ³¨å†Œæ‰€æœ‰å·¥å…·
    for (const tool of plugin.tools) {
      toolExecutor.register(tool.schema, tool.handler);
    }
  }
}
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å‚æ•°éªŒè¯ç¼“å­˜

```typescript
class ToolExecutor {
  private validatorCache = new Map<string, ValidateFunction>();
  
  private getValidator(toolName: string): ValidateFunction {
    if (!this.validatorCache.has(toolName)) {
      const schema = this.schemas.get(toolName);
      const validator = ajv.compile(schema.parameters);
      this.validatorCache.set(toolName, validator);
    }
    return this.validatorCache.get(toolName)!;
  }
}
```

### 2. å¹¶è¡Œæ‰§è¡Œ (æœªæ¥)

```typescript
// å½“å¤šä¸ªå·¥å…·è°ƒç”¨ç‹¬ç«‹æ—¶ï¼Œå¯å¹¶è¡Œæ‰§è¡Œ
async executeParallel(toolCalls: ToolCall[]): Promise<ToolResult[]> {
  return await Promise.all(
    toolCalls.map(call => this.execute(call))
  );
}
```

## ğŸ“š æœ€ä½³å®è·µ

### å·¥å…·è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£** - æ¯ä¸ªå·¥å…·åªåšä¸€ä»¶äº‹
2. **æ¸…æ™°å‘½å** - ä½¿ç”¨åŠ¨è¯å¼€å¤´ï¼Œå¦‚ readFile, listFiles
3. **è¯¦ç»†æè¿°** - description è¦æ¸…æ™°ï¼Œå¸®åŠ© LLM ç†è§£
4. **å‚æ•°éªŒè¯** - ä½¿ç”¨ JSON Schema ä¸¥æ ¼éªŒè¯
5. **é”™è¯¯å¤„ç†** - æä¾›å‹å¥½çš„é”™è¯¯ä¿¡æ¯
6. **å¹‚ç­‰æ€§** - ç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡º

### Schema ç¼–å†™æŠ€å·§

```typescript
// âœ… å¥½çš„ Schema
{
  name: 'searchFiles',
  description: 'ä½¿ç”¨ glob æ¨¡å¼æœç´¢æ–‡ä»¶ã€‚ä¾‹å¦‚: **/*.ts åŒ¹é…æ‰€æœ‰ TypeScript æ–‡ä»¶',
  parameters: {
    type: 'object',
    properties: {
      pattern: {
        type: 'string',
        description: 'glob æ¨¡å¼ï¼Œå¦‚ **/*.js, src/**/*.tsx'
      }
    },
    required: ['pattern']
  }
}

// âŒ ä¸å¥½çš„ Schema
{
  name: 'search',  // å¤ªæ¨¡ç³Š
  description: 'æœç´¢',  // æè¿°ä¸æ¸…
  parameters: {
    type: 'object',
    properties: {
      p: { type: 'string' }  // å‚æ•°åä¸æ¸…æ™°
    }
  }
}
```

## ğŸ—ºï¸ æœªæ¥è§„åˆ’

### v0.3.0
- [ ] æ–‡æ¡£å¤„ç†å·¥å…· (Word, PDF, Excel)
- [ ] Obsidian ç¬”è®°å·¥å…·
- [ ] æ•°æ®åº“æŸ¥è¯¢å·¥å…·

### v0.4.0
- [ ] ç½‘ç»œè¯·æ±‚å·¥å…· (HTTP API è°ƒç”¨)
- [ ] é‚®ä»¶å·¥å…· (å‘é€/æ¥æ”¶)
- [ ] æ—¥å†å·¥å…· (äº‹ä»¶ç®¡ç†)

### v0.5.0
- [ ] å·¥å…·æ’ä»¶ç³»ç»Ÿ
- [ ] å·¥å…·å¸‚åœº
- [ ] å·¥å…·ä½¿ç”¨ç»Ÿè®¡

---

**[[äº§å“éœ€æ±‚æ–‡æ¡£|è¿”å› PRD ä¸»é¡µ]]** | **[[æŠ€æœ¯æ¶æ„|æŠ€æœ¯æ¶æ„è¯¦æƒ…]]**
